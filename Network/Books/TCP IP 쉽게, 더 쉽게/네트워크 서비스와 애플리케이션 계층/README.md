# 2장 네트워크 서비스와 애플리케이션 계층

애플리케이션 계층의 프로토콜이 하는 일은 특정 서비스를 제공하기 위해 서버와 클라이언트 사이에서 다양한 메시지나 명령을 주고 받는 것이다. 애플리케이션 계층은 사용자에게 직접 노출되는 부분이기 때문에 상대적으로 다른 계층보다 더 중요한 계층으로 보이게 된다. 하지만 애플리케이션 계층이 서비스 제공에 집중할 수 있는 것은 트랜스포트 계층을 포함한 하위 계층에서 데이터 전송을 잘 처리해주고 있기 때문이다.
통신이 제대로 이루어지기 위해서는 네트워크 계층 모델중 어느 한 계층도 빠져서는 안되며, 이들 계층의 역할이 모두 중요하다.
애플리케이션 계층은 사용자가 직접 사용하면서 체감할 수 있는 서비스를 제공한다. 네트워크 계층 모델중 트랜스포트 이하의 계층들은 데이터 전송을 담당하고 있으므로 이들 데이터 전송 관련 계층을 제외한 모든 영역이 애플리케이션 계층의 범주라고 보면 된다.
인터넷을 사용하는 서비스중 가장 대표적인 WWW(World Wide Web)은 HTTP라는 프로토콜을 사용한다.
웹브라우저가 웹서버로 특정 웹페이지를 요청하면 웹 서버가 해당 페이지의 내용을 HTML형식으로 응답한다.웹 브라우저는 이 데이터를 해석하여 웹 페이지 화면을 그린후 사용자에게 보여준다. URL로 페이지를 요청하면 파일로 응답을 돌려주는 간단한 동작 방식이다. HTTP메시지는 request line, status line, header, blank line, message body로 구성된다.
HTTP는 통신시 정보를 한 번씩 주고 받은후 바로 끊는 형태로 처리된다. 이렇게 상태 정보를 저장하지 않는 통신형태를 스테이트리스(stateless)라고 한다. HTTP는 대표적인 무상태 프로토콜이다.(HTTP는 상태가 없다. stateless) 웹 서비스에서는 상태 정보 유지를 위한 별도의 처리가 필요하다.
특정 웹페이지를 받아보기 위해서는 HTTP요청을 보내야하는데 이때 URL(Uniform Resource Locator) 이라는 문자열을 사용한다.
GET요청인 경우 별도의 요청 내용인 메시지 바디가 없다.
웹 서비스나 웹 어플리케이션은 웹의 동작 방식을 응용하여 사용자와 상호작용하기 위해 만들어진 프로그램이다. 웹 서비스를 요청하면 웹 서버가 결과를 미리 만들어 놓지 않고 서버 프로그램이 HTML 데이터를 동적으로 만들어서 응답한다. 웹 페이지와 웹 서비스의 차이는 미리 만들어둔 정적인 HTML파일로 응답하느냐, 아니면 서버 프로그램이 요청 내용에 따라 동적으로 HTML데이터를 만들어 응답을 하느냐의 차이이다.
웹 서버에서 동작하는 프로그램을 서버사이드 프로그램 혹은 서버측 프로그램이라고 한다. 서버측 프로그램은 HTTP메시지를 주고받는다는 조건만 맞으면 구현 방법은 어떤 것이라도 상관 없기 때문에, Perl, PHP, Python, Ruby등의 다양한 언어로 개발된다. 웹 초장기에는 웹서버에서 이들 서버측 프로그램을 실행하기 위해 CGI(Common GateWay Interface)라는 방식을 사용했었다. 이후에는 CGI보다 응답 속도가 우수한 웹서버 추가 모듈 형태로 동작하는 방식이 바뀌었다. 최근의 웹 서비스는 시스템의 사용성을 높이기 위해서 AJAX(Asynchronous js and xml)이라는 기술을 적용한다. AJAX는 HTTP메시지로 통신한다는 점에서 일반적인 요청 방식과 비슷하지만, 요청을 보내는 주체가 브라우저가 아닌 자바스크립트라는것에 차이가 있다. 즉 AJAX는 웹 브라우저가 웹 서버로 요청하는 것이 아니라, 자바스크립트로 작성된 프로그램이 웹 서버와 통신한다. 그리고 응답 결과로 받은 내용에 대해서는 웹 브라우저가 전체 페이지를 다시 그려 화면을 갱신하는 방식이 아니라, 자바스크립트가 웹 페이지 특정 부분에만 응답 받은 내용이 갱신되도록 처리한다. 결과적으로 사용자는 전체페이지를 다시 조회하지 않아도 되고, 서버의 응답을 바로 받아 상호작용할 수 있으므로 보다 자연스러운 서비스 이용과 보다 향상된 사용자 경험을 느낄 수 있다.

## 세션을 유지하기 위한 쿠키

HTTP는 무상태 프로토콜이기 때문에 요청과 응답을 한번씩 주고받은 후에 통신이 끊어진다. 그래서 온라인 쇼핑몰에서 상품을 선택하고 구입 결정을 한 후에 결제 화면으로 이동하는 것처럼 여러단계의 흐름 처리를 할 때는 각 요청이 동일한 사용자가 보낸 것인지 다른 사용자가 보낸 것인지 판단하지 못한다. 이런 경우 여러 건의 요청 처리를 동일한 사용자 접속 세션으로 인식 할 수 있도록 쿠키를 사용한다. HTTP는 기본적으로 요청과 응답하는 과정에서 상태 정보를 저장하지 않아 무상태 혹은 스테이트리스 프로토콜이라고 하며, 상태를 유지하면서 연속된 응답을 해야 할 때는 쿠키라는 기술을 사용한다.
웹 브라우저는 응답받은 메시제에 'Set-Cookie'라는 문자열이 있는지 확인하고 , 만약 있으면 그 내용을 로컬 디스크에 쿠키 형태로 저장한다. 쿠키 정보는 악용될 경우 보안 문제가 발생할 수 있기 때문에 이에 대비한 조치가 필요한데, 기본적으로 웹브라우저가 이에 대한 방어책을 자체적으로 구현하고 있다. 예를 들면, 쿠키가 생성된 웹서버와 동일한 도메인을 사용하는 웹사이트에서만 쿠키가 전송되도록 제한하거나, 이미 저장된 쿠키들이 있다면 유효기간을 확인하고 유효기간이 지난 것은 자동으로 폐기하기도 한다.
