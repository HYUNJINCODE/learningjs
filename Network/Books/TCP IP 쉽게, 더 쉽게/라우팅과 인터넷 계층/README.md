# 4장 라우팅과 인터넷 계층

인터넷 계층의 역할은 송신지 컴퓨터의 데이터를 수신지 컴퓨터까지 전달하는 것이다.
인터넷에는 수많은 컴퓨터가 연결되어 있기 때문에 수신지 컴퓨터를 정확하게 찾아내기 위해서는 고유 식별자가 필요하다. 이때 사용되는 식별자가 바로 IP어드레스이다.
IP어드레스는 흔히 우편번호나 전화번호로 비유되는데, 수신지의 정보를 표현한다는 측면에서는 비슷하지만 차이점이 분명 존재한다. 우편번호의 앞 세자리는 특별시, 도와 시, 군, 자치구를 의미하는데, 예를 들어 앞자리가 108로 시작하면 경기도 파주시에 해당한다. 전화번호의 지역번호는 앞 세자리가 지역을 의미하는데, 예를 들어 031이라면 경기도에 해당한다. 이렇게 우편번호와 전화번호가 지역정보를 포함하는 것과 달리 IP어드레스는 지리적인 위치와는 상관없이 네트워크 단위로 할당된다. 그래서 IP어드레스를 보면 그 컴퓨터가 어느 지역에 있느냐를 알수 있는 것이 아니라 어느 네트워크에 속해 있느냐를 알수 있고, 소속된 네트워크의 규모도 짐작할 수 있다. IP어드레스를 할당받을 때 발급 기관이나 할당받은 조직이 어느 정도 지리적인 범위 내에 있으므로 큰 범위에서의 유추 정도는 가능하다. 다만 IP어드레스는 지역별로 할당되지 않고 네트워크 단위로 할당되기 때문에 엄밀하게는 지역 정보를 포함하지 않는다고 보는 것이 정확하다.
IP어드레스에는 지리적인 위치 정보가 포함되어 있지 않다. 데이터가 전달될 수신지를 찾기 위해서는 우편번호나 전화번호와는 다른 방법을 사용해야 한다. 라우터라는 네트워크 장비는 하나의 네트워크가 또 다른 네트워크와 연결되어 있다는 것과 같이 네트워크 간의 연결 정보를 관리한다. IP 어드레스를 보면 소속된 네트워크가 어딘지 알수 있는데, 해당 네트워크에 연결된 라우터를 추적하다 보면 그 장비가 최종적으로는 목표로 한 수신지 컴퓨터를 찾게 되고 송신지에서 수신지까지 연결되는 통신 경로를 만들수 있게된다. 단, 인터넷 계층이 데이터를 전달하는 방식은 지리적인 위치나 거리와는 상관이 없기 때문에 물리적으로는 가까운 거리에 있음에도 불구하고 네트워크 간의 연결 구조상 통신 경로가 멀리 우회해서 간다거나, 반대로 네트워크간의 연결 구조는 가까우나 실제로는 바다를 건널 정도로 지리적으로 멀리 떨어져 있을 수도 있다.

## 인터넷 계층의 역할

인터넷 계층의 프로토콜은 수신지 컴퓨터가 아무리 멀리 있더라도 데이터를 전달할 수 있도록 설계되어있다.
IP어드레스 정보를 보고 데이터를 전달한다.
인터넷 계층은 네트워크 인터페이스 계층과 협력하여 다른 컴퓨터에게 데이터를 전달하는 역할을 한다. 하드웨어에 의존해야 하는 부분은 네트워크 인터페이스 계층이 담당하고, 인터넷 계층은 IP어드레스라고 하는 식별자 정보를 실마리로 데이터를 전달할 수 있는 체계를 제공하도록 역할이 각각 구분되어있다.
데이터를 목적지까지 전달하기 위해서는 라우터라고 하는 네트워크 장비가 필요하다. 라우터는 네트워크와 네트워크를 연결하는 역할을 하는데, 하나의 라우터는 데이터를 목적지까지 전달하기 위해다음 네트워크의 경로를 찾고, 그 경로상에 있는 라우터에게 데이터 전달을 위임한다.이런 과정은 최종 목적지를 찾기까지 연쇄적으로 반복되는데, 이렇게 라우터가 목적지의 경로를 찾아 나가는 과정을 라우팅(routing)이라고 한다.라우터가 자신이 속한 네트워크에 목적지 컴퓨터가 속해 있다면 그 컴퓨터에게 데이터를 전달한다.
인터넷 보급이 급속도로 확산됨에 따라 사용 가능한 IP어드레스는 점점 줄고 있다. 그래서 IP어드레스의 고갈을 방지하기 위한 대안으로 프라이빗 어드레스와 퍼블릭어드레스를 구분하는 기법을 사용한다. 한편 근본적인 방법으로는 IPv4보다 주소 체계가 확장된IPv6의 도입이 가속화 되고있다. 그 외에도 IP어드레스와 관련된 기술로는 숫자로 된 IP어드레스를 사람이 알아보기 쉬운 도메인명과 연결해 주는DNS등이 있다.

## IPv4와 IPv6

IPv4와 IPv6는 인터넷 계층에서 사용되는 중요한 프로토콜로, IP어드레스를 결정할 때 사용하는 비트의 길이가 서로 다르다. IPv4는 현재까지 컴퓨터의 어드레스를 지정할 때 가장 많이 사용되는 인터넷 계층의 프로토콜이다. 네트워크에 연결된 컴퓨터를 식별하기 위해 32비트의 IP어드레스가 사용된다. 단,32비트 문자열은 사람이 알아보기 어렵기 때문에 전체 32비트를 8비트씩 4단위로 끊은 후에 10진수로 변환하여 표기하고 있다. 인터넷 계층에서 사용되는 장비에만IP어드레스가 할당된다. 여러 네트워크 장비들중 네트워크 허브와 같이 네트워크 인터페이스 계층에서 사용되는 장비들에는 IP어드레스가 할당되지 않는다. IPv4 패킷의 IP헤더에는 송신지와 수신지의 IP어드레스 외에도 패킷 길이와 같은 다양한 정보들이 들어있다. 트랜스포트 계층에서 전달받은 데이터에 IP헤더를 덧붙인다.
수신지로 지정된 컴퓨터가 실제로는 존재하지 않거나 통신 경로를 찾지 못해 패킷이 제대로 전달되지 않는 경우가 종종 발생할 수 있다. 이렇게 패킷이 목적지를 찾지못해 네트워크 안을 계속 떠돌게 되면 네트워크가 혼잡해질 수 있는데, 이러한 문제를 방지하기 위해 IPv4헤더에는 생존기간정보를 설정 할 수 있게 되어있고, 만약 생존기간을 초과한 패킷이 네트워크 상에서 발견되면 그 패킷을 소멸시키도록 규정하고 있다.
한번에 전송할 수 있는 데이터 크기를 MTU(Maximum Transmission Unit)이라고 하고, 이 값은 통신경로의 상태에 따라 달라진다. 예를 들어, 경로 상태가 좋지 않으면 이 값이 줄어들게 되는데, 라우터에는 이 MTU 값에 따라 패킷을 분할해서 전송하는 기능이 구현되어 있다. 다만 라우터의 작업 부하가 높아지거나 분할된 패킷 중의 일부가 유실되면 복원이 어려워지는 단점이 있다. 그래서 라우터가 데이터를 송신히기 전에 통신경로 전체의 MTU를 살펴본후 처음부터 MTU보다 작은 크기의 패킷을 만들도록 설정하기도 한다.
인터넷의 급격한 성장으로 인해 IPv4의 32비트 어드레스가 머지않아 고갈될 상황에 이르렀다.
IPv6 어드레스의 길이는 128비트이고, 2의 128승개, 즉 약 340간개의 장비들을 식별할 수 있다.
IPv6 와 IPv4는 어드레스나 패킷 어느것으로도 서로 호환이 되지 않는다. 그래서 현재는 여러 다양한 기법을 사용해서 두가지를 병행할 수 있도록 만드는 등 IPv6로 이행하기 위한 노력이 계속되고있다. 하나의 장비에 두 종류의 어드레스를 할당한 후 둘다 사용 가능하도록 만드는 것은 듀얼 스택이라고 한다. Ipv4네트워크를 지나갈 때는 Ipv4패킷안에 Ipv6패킷을 채워서 보내는 것을 터널링이라고 한다.
